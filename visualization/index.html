<!-- IMPORTANT GUIDELINES
1. div #canvas wraps this html block. 
2. div #canvas-svg is used for svg rendering. It can be placed anywhere here.
3. Do not define an html page here, i.e. including html, head, body tags. -->

<div id="canvas-svg"></div>
<!-- Underscore -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<!-- D3.js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.5/nv.d3.min.js"></script>
<!-- Customized css -->
<link rel="stylesheet" type="text/css" href="graph.css" media="screen" />

<!-- JS dependencies -->
<script src="graph.js"></script>

<!-- Hardcode dataset (in avoid of hosting a http server) -->
<!-- <script src="test_data.js"></script> -->
<script src="graph/nodes.js"></script>
<script src="graph/links.js"></script>
<!-- Main function -->
<script type="text/javascript">
	var MIN_VALUE = 0,
		MAX_VALUE = _.max(links, function(link){ return link.value }).value;

	var cities = _.keys(nodes),
		_nodes = _.chain(nodes)
			.values()
			.map(function(node){
				node.group = _.indexOf(cities, node.city_name);
				return node; })
			.value(),
		_links = _.map(links, function(link){
				link.source = _.indexOf(cities, link.source);
				link.target = _.indexOf(cities, link.target);
				link.value = link.value > MIN_VALUE ? (link.value - MIN_VALUE) / MAX_VALUE : 0;
				return link; });

	var _graph  = {
		"nodes": _nodes,
		"links": _links
	};

	drawD3Document(_graph);
</script>
